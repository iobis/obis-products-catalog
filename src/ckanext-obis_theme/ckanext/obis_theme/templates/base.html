{% ckan_extends %}

<!--Add new stylesheet-->
{% block styles %}
  {{ super() }}
  <!--<link rel="stylesheet" href="{{ h.url_for_static('/css/theme.css') }}">-->
  <link rel="stylesheet" href="/css/theme.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
{% endblock %}

{% block scripts %}
  {{ super() }}

  <script>
    console.log('DOI redirect script loading...');

    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, looking for Add Dataset buttons...');

      function redirectAddDatasetButtons() {
        var addLinks = document.querySelectorAll('a');
        var found = 0;

        addLinks.forEach(function(link) {
          var text = link.textContent.trim().toLowerCase();
          var href = link.getAttribute('href') || '';

          // Skip buttons that explicitly say "create manually"
          if (text.includes('create manually') || text.includes('manual')) {
            return;
          }

          if ((text.includes('add') && text.includes('dataset')) || href.includes('/dataset/new')) {
            console.log('Redirecting button:', text, href);
            link.href = '{{ h.url_for("doi_import.dataset_new_choice") }}';
            found++;
          }
        });

        console.log('Redirected', found, 'buttons');
        return found > 0;
      }

      // Try immediately
      if (!redirectAddDatasetButtons()) {
        // Try again after a delay (for dynamically loaded content)
        setTimeout(redirectAddDatasetButtons, 1000);
      }
    });
  </script>
{% endblock %}
